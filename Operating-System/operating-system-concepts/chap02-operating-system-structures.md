# Operating-System Structure

## Operating-System Services

운영체제는 프로그램이 실행될 수 있는 환경을 제공한다.

- 사용자 인터페이스: CLI(커맨드 라인 인터페이스,  shell), GUI(마우스, 터치스크린 등), 배치 인터페이스(명령을 파일에 넣어두고 실행)
- 프로그램 실행: 프로그램을 메모리에 로드해서 실행하고 종료한다.
- 입출력 명령: 프로그램이 입출력을 요구하면 운영체제가 명령을 수행한다.
- 파일시스템 조작: 파일을 읽고 쓰며 파일 검색, 삭제, 생성 등을 수행한다.
- 통신: 공유 메모리와 메시지 패싱을 통해 프로세스간의 통신을 가능하게한다.
- 에러 탐지: CPU, 메모리 하드웨어, 입출력, 사용자 프로그램에서 발생하는 에러를 탐지한다.
- 자원 할당: 다수의 사용자나 작업들이 동시에 수행될 때 다양한 요인을 고려해 자원을 적절하게 할당한다.
-	회계: 사용자가 컴퓨터 자원을 얼마나, 어떻게 사용하는지 추적한다.
-	보호와 보안

## System Calls

시스템 콜은 운영체제에 의해 사용할 수 있는 서비스들에 대한 인터페이스를 제공한다.

시스템 콜을 통해 커널 모드를 사용할 수 있으며 대부분 `stdio.h`와 같은 표준 라이브러리, API를 통해 시스템 콜을 호출한다.

운영체제에 매개변수를 전달하는 방법은 다음과 같다.

- 매개변수를 레지스터에 전달(call by value)
- 매개변수를 메모리의 블록에 저장하고 블록의 주소가 레지스터에 저장(call by reference)
- 스택에 매개변수를 추가

시스템 콜은 다음과 같이 분류할 수 있다.

- 프로세스 제어: 로드, 실행, 종료, 중지
- 장치 조작: 메인 메모리, 디스크 드라이브 등의 장치의 요구, 방출, 읽기, 속성 획득 등
- 파일 조작: 파일 생성, 삭제, 열기, 읽기, 쓰기 등
- 정보 유지: 시간, 날짜 획득 및 설정
- 통신: 메시지 패싱, 공유 메모리를 통한 프로세스 통신
- 보호

## OS Structure

### Simple Structure

과거 운영체제 중 하나인 MS-DOS는 계층이 잘 분리되어 있지 않다. 사용자 프로그램이 직접 디스플레이와 디스크 드라이브에 쓰는 것이 가능했다. 따라서 사용자 프로그램에 문제가 생기면 시스템 전체에 문제가 생겼다.

이것을 개선한 것이 UNIX인데 UNIX는 사용자 계층 아래의 시스템 콜 인터페이스와 하드웨어 계층 위의 커널 인터페이스로 구성되어 있으며 이 두 인터페이스 사이가 커널이다. 시스템 콜을 통해 커널에서 여러 기능을 제공한다. 이러한 모놀리식한 구조는 구현과 유지보수가 어렵다는 단점이 있다.

### Layred Approach

계층적 접근 방식의 운영체제는 계층을 더 세분화한 구조이다. 운영체제가 여러 층으로 나누어져 있으며 layer 0은 하드웨어, 최상위 레이어인 layer N은 사용자 인터페이스이다. 

각 계층들은 하위 계층의 서비스와 연산만을 사용할 수 있어 디버깅이 간단하지만 계층을 정의하기 어렵다는 단점이 있다.

### Microkernels

프로세스 통신, 메모리 관리 등의 핵심적인 요소만 남기고 나머지는 시스템 및 사용자 레벨 프로그램으로 구현하는 구조이다. 


## System Boot

부팅시 운영체제가 실행되는 과정은 다음과 같다.

1. 컴퓨터에 전원이 인가되면 ROM에 있는 Basic Input Output System, BIOS 데이터를 읽는다
2. BIOS는 Power on Self Test, POST를 통해 하드웨어가 정상적으로 작동하는지 확인한다.
3. BIOS가 부트스트랩 프로그램을 실행해 부팅 정보 즉, 부트 로더를 메모리로 읽어 온다.
4. 부트 로더가 디스크에 저장되어 있는 운영체제 코드를 메모리로 읽어온다.
5. 운영체제가 실행된다.

<br>

## Summary

- 운영체제는 프로그램이 실행될 수 있는 환경을 제공하며 사용자 인터페이스, 프로그램 실행, 입출력, 파일 시스템 등의 기능을 제공한다.
- 시스템 콜은 운영체제가 제공하는 서비스에 대한 인터페이스이다. 라이브러리, API를 통해 호출할 수 있다.
- 마이크로 커널은 커널에 핵심적인 요소만 남기고 나머지는 제거한 형태로 구성한 운영체제이다.
- 부팅은 `ROM에 저장된 BIOS -> POST -> 부트스트랩 실행 -> 부트로더가 운영체제 코드를 메모리로 읽어옴 -> 운영체제 실행` 순으로 실행된다.

---

### Reference

- [운영체제 공룡책 강의](https://www.inflearn.com/course/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B3%B5%EB%A3%A1%EC%B1%85-%EC%A0%84%EA%B3%B5%EA%B0%95%EC%9D%98#curriculum)
- [공룡책으로 정리하는 운영체제 - CHAPTER 2](https://blog.naver.com/bisu1532/221612466313)
- [부팅 시 운영체제가 실행되는 과정](https://neos518.tistory.com/113)
