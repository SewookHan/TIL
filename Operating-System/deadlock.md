# Deadlock

교착 상태, 데드락이란 프로세스가 요청한 리소스를 다른 대기 프로세스가 선점해 프로세스가 대기 상태에 들어가는 상황을 의미한다. 데드락은 상호 배타적인 리소스를 공유하는 다중 프로세싱에서 자주 발생하는 문제이다.

<br>

![](https://cdn.guru99.com/images/1/122319_0715_Introductio1.png)

### What causes a Deadlock?

데드락이 발생하는 4가지 조건은 다음과 같다.

- 비선점 : 이미 할당된 자원을 강제로 가져올 수 없다.
- 상호 배제 : 프로세스는 한 번에 하나의 리소스는 사용할 수 있으며 사용중인 리소스를 다른 프로세스가 사용하기 위해서는 요청한 자원이 해제될 때까지 기다려야한다.
- 점유 대기 : 자원을 최소한 하나만 보유하고 다른 프로세스에 할당된 자원을 점유하기 위해 대기하는 프로세스가 존재해야한다.
- 순환 대기 : 프로세스들은 순환 형태로 자원을 대기하고 있어야한다.

<br>

## Deadlock Detection and Prevention

데드락은 리소스 스케줄러에 의해 감지될 수 있다. 리소스 스케줄러는 운영체제가 다른 프로세스에 할당된 모든 리소스를 추적하는 역할을 한다. 만약 리소스 스케줄러가 데드락을 감지할 경우 다음과 같은 방법으로 해결할 수 있다.

<br>

### No preemptive action

데드락 발생 조건 중 하나인 비선점을 해결하기 위한 방법이다. 비선점 조건은 선점 가능한 프로토콜 생성을 통해 해결할 수 있다.

- 특정 리소스를 사용중인 프로세스가 즉시 할당이 불가능한 다른 리소스를 요청하면 모든 리소스가 해제된다. 
- 선점된 리소스에는 대기 중인 프로세스의 리소스 목록이 필요하다.
- 프로세스가 다른 리소스를 요청할 때, 해당 리소스가 사용 가능하면 요청 프로세스에 제공된다.
- 다른 리소스를 기다리고 있는 프로세스 A가 어떤 리소스를 점유하고 있고, 프로세스 A가 점유 중인 리소스를 대기하고 있는 프로세스 B가 존재할 경우 그 리소스는 프로세스 B가 점유할 수 있다.

<br>

### Mutal Exclusion

상호 배제란 한 프로세스가 공유 리소스를 점유하고 있을 때, 다른 프로세스가 해당 리소스를 사용할 수 없는 것을 의미한다. 쉽게 말해 두 프로세스는 동시에 공유 리소스에 진입할 수 없다.

상호 배제는 데커 알고리즘, 크누스 알고리즘 등으로 다수의 프로세스가 한 번에 공유 리소스를 사용하게함으로써 해결할 수 있다.

<br>

### Hold and Wait

한 프로세스의 실행 전 모든 리소스를 할당하고 점유하지 않을 때 다른 프로세스가 해당 리소스를 요구하도록 하는 방법이다. 리소스 과다 사용으로 인한 효율성, 리소스 저장 및 복원 비용, 기아 상태, 무한 대기 등의 문제가 발생할 수 있다.

<br>

### Circular wait

리소스에 대해 순서를 매겨 모든 프로세스가 순서에 따라 리소스를 요청하게함으로써 해결할 수 있다.

<br>

## Deadlock Avoidance

다음은 데드락을 회피하기 위한 방법이다.

<br>

### Avodance Algorithms

데드락 회피 알고리즘은 순환 대기 상황이 발생하지 않도록 동적으로 리소스를 할당하기 위한 알고리즘이다. 

- 리소스 할당 그래프 사용
- 데드락을 회피해기 위한 안전 상태(safe state) 및 안전 순서(self sequence)
- 은행원 알고리즘(banker's algorithm)

<br>

## Features of Deadlock

데드락과 기아 상태의 특징과 차이점은 다음과 같다.

| 데드락                                                       | 기아 상태                                                    |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 데드락은 프로세스 중 하나가 차단(block)되었을때 발생한다.    | 기아 상태는 낮은 우선순위의 프로세스가 모두 차단되고 높은 우선순위를 가진 프로세스가 실행되는 상황을 의미한다. |
| 데드락은 infinite process이다                                | 기아 상태를 해결하기 위해선 오랜 대기 시간이 필요하지만 infinite process는 아니다. |
| 데드락엔 항상 기아 상태가 존재한다.                          | 모든 기아 상태가 데드락은 아니다.                            |
| 데드락이 발생하면 상호 배제 및 점유 대기가 발생하지만 비선점과 순환대기는 동시에 발생하지 않는다. | 기아 상태는 제어되지 않은 우선 순위 및 리소스 관리로 인해 발생한다. |

<br>

### Advantages and Disadvantages of Deadlock

데드락 방식의 장점은 다음과 같다.

- 상태 저장 및 복구가 쉬운 리소스에 적합하다.
- 시스템 설계시 문제가 되지않으므로 런타임 계산이 필요없다.

데드락 방식의 단점은 다음과 같다.

- 프로세스의 시작이 지연된다.
- 필요 이상의 리소스 선점이 발생한다.
- 프로세스는 후에 발생할 리소스 요구 사항을 알고 있어야한다.

<br>

<br>

------

##### Reference

- [Introduction to DEADLOCK in Operating System](https://www.guru99.com/deadlock-in-operating-system.html)
- [[운영체제] 데드락(Deadlock, 교착 상태)이란?](https://chanhuiseok.github.io/posts/cs-2/)

